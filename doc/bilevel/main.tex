%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
% 	DO NOT MODIFY HERE, SCROLL DOWN
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\documentclass[a4paper,11pt]{article}
\usepackage[latin1]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx,amsmath,amsfonts,amssymb,a4wide}

\usepackage{listings}
\usepackage{color}
\include{macros}

\newenvironment{vuoto}{}{}
\newenvironment{abst}{
\textbf{Abstract}\begin{vuoto}}{
\end{vuoto}}

\newenvironment{keyw}{
\textbf{Keywords:}\begin{vuoto}}{
\end{vuoto}}



\newcommand{\papertitle}[1]{%
\begin{center}
\LARGE \textbf{#1} \\
\vspace*{0.5cm}
}
\newcommand{\session}[1]{%
\newpage
\begin{center}
%\Large 
\textit{#1} \\
\end{center}
\vspace*{0.5cm}
}
\newcommand{\presentername}[1]{%
\normalsize
\textbf{#1}$^*$ \\
}
\newcommand{\presenteraffiliation}[2]{%
\normalsize \emph{#1}, \texttt{#2} \\
\vspace*{1ex} 
}
\newcommand{\coauthorname}[1]{%
\normalsize
\textbf{#1} \\
}
\newcommand{\coauthoraffiliation}[2]{%
\normalsize \emph{#1}, \texttt{#2} \\
\vspace*{1ex}
}
\newcommand{\paperabstract}[1]{%
\setcounter{figure}{0}
\end{center}
\begin{abst}
\normalsize #1
\end{abst}
\vspace*{1ex}
}



\newcommand{\paperkeywords}[1]{%
\begin{keyw}
\normalsize \emph{#1}
\end{keyw}
\vspace*{1ex}
}





\newenvironment{papertext}{}

\newcommand{\vref}[1]{
\item #1
}
\newcommand{\paperreferences}[1]{%
~\\
\noindent \large \textbf{References}
\renewcommand{\theenumi}{[\arabic{enumi}]}
\renewcommand{\labelenumi}{\theenumi}
\begin{enumerate}
\normalsize
#1
\end{enumerate}
\newpage
}

\begin{document}

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
% 		MODIFY HERE
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


%------- Session of the talk (invited or contributed)
\session{Contributed session}
%------- Title of the talk
\papertitle{Modeling Multilevel Programs in Pyomo}
%------- Speaker
\presentername{William E. Hart\index{Hart, William E.|pp}}
\presenteraffiliation{Center for Computer Research, Sandia National Laboratories}{wehart@sandia.gov}
%------- Coauthor 1
\coauthorname{Bryan Arguello\index{Arguello, Bryan|ca}}
\presenteraffiliation{Energy and Geoscience Center, Sandia National Laboratories}{barguel@sandia.gov}
\coauthorname{John Siirola\index{Siirola, John|ca}}
\presenteraffiliation{Center for Computer Research, Sandia National Laboratories}{jdsiiro@sandia.gov}
\coauthorname{Bismark Singh\index{Singh, Bismark|ca}}
\presenteraffiliation{Center for Computer Research, Sandia National Laboratories}{bsingh@sandia.gov}
\coauthorname{Jean-Paul Watson\index{Watson, Jean-Pual|ca}}
\presenteraffiliation{Center for Computer Research, Sandia National Laboratories}{jwatson@sandia.gov}


%------- Abstract (max 3 pages)
\paperabstract{
We describe capabilities for modeling bilevel and multilevel programs
within the Pyomo modeling software.  These capabilities include
modeling components that represent subproblems, modeling transformations
for re-expressing models with bilevel structure in other forms, and
optimize bilevel programs with meta-solvers that apply transformations
and then perform optimization on the resulting model.  We illustrate
the application of Pyomo to model powergrid reliability problems.
}
%This is an example of the short abstract template (max 3 pages) and how to cite (max 3) references \ref{CY59}, \ref{CP61}.


\paperkeywords{algebraic modeling languages, reformulations, powergrid security}

\section{Introduction}

Although multilevel problems arise in many applications, few algebraic
modeling languages (AML) have integrated capabilities for expressing
these problems.  AMLs are high-level programming languages for
describing and solving mathematical problems, particularly
optimization-related problems.  AMLs provide a mechanism
for defining variables and generating constraints with a concise
mathematical representation, which is essential for large-scale,
real-world problems that involve thousands or millions of constraints
and variables.  GAMS, YALMIP and Pyomo
provide explicit support for modeling bilevel programs.  A variety
of other AMLs support the solution of bilevel programs through the
expression of Karush-Kuhn-Tucker conditions and associated
reformulations using mixed-complementarity conditions, but these
reformulations must be expressed by the user in these AMLs.

The main point of this paper is to describe modeling techniques in
Pyomo that can express complex multilevel optimization problems.
Pyomo is an open-source software package that supports the definition
and solution of optimization applications using the Python
language~\ref{PyomoBook17}.  Python is a powerful programming
language that has a clear, readable syntax and intuitive object
orientation.  Pyomo uses an object-oriented approach for defining
models that contain decision variables, objectives, and constraints.

Multilevel models can be easily expressed with Pyomo modeling
components for submodels, which can be nested in a general manner.
Further, Pyomo's object-oriented design naturally supports the
ability to automate the reformulation of multilevel models into
other forms.  In particular, we describe Pyomo's capabilities for
transforming bilevel models for several broad classes of problems,
and we illustrate this capability on a power grid security application.

\section{Modeling Bilevel Programs}

The \code{pyomo.bilevel} package extends Pyomo by defining a new
modeling component: \code{SubModel}.  The \code{SubModel} component
defines a subproblem that represents the lower level decisions in
a bilevel program.  This component is like Pyomo's \code{Block} component;
any components can be added to a \code{SubModel} object.  In general,
a submodel is expected to have an objective, one or more variables
and it may define constraints.

The \code{SubModel} class generalizes the \code{Block} component
by including constructor arguments that denote which variables in
the submodel should be considered fixed or variable.  When expressions
in a submodel refer to variables defined outside of the submodel,
the user needs to indicate whether these are fixed values defined
by an upper-level problem.  Fixed variables are treated as constants
within the submodel, but non-fixed variables are defined by the
current submodel or by a lower-level problem.

Consider the following example:
\begin{equation}
\begin{array}{lll}
\min_{x, y, v}      & x + y + v & \\
\st                 & x + v \geq 1.5 \\
                    & 1 \leq x \leq 2 &\\
                    & 1 \leq v \leq 2 & \\
                    & \max_{y,w}  & x + w\\
                    &           & y + w \leq 2.5 \\
                    &           & 1 \leq y \leq 2\\
                    &           & 1 \leq w \leq 2
\end{array}
\end{equation}\\
The following Pyomo model defines four variables, \code{x}, \code{v}, \code{sub.y} and \code{sub.w}:
\listing{simple.py}{pyomo}{2}{15}

\mbox{}\\
Variables \code{x} and \code{v} are declared in the upper-level
problem, and \code{v} only appears in the upper-level problem.
Variables \code{sub.y} and \code{sub.w} are declared in the submodel.
However, note that the \code{sub.y} variable appears in the upper-level
problem, while the \code{sub.w} variable only appears in the
lower-level problem.

\section{Bilevel Optimization for Power Grid Security and Resiliency}

Expressions in
submodels can be linear or nonlinear, convex or nonconvex, continuous
or discontinuous, and more.  Additionally, submodels can be nested
to an arbitrary degree.  Thus, the range of bilevel programs that
can be expressed with Pyomo is quite broad.  However, the real
challenge is solving these models.

Pyomo's supports the structured transformation of models, and this
capability can be applied to transform bilevel and multi-level
problems into standard forms.  Pyomo's object-oriented design allows
the transformation of sub-models within a formulation.  Additionally,
blocks of constraints can be activated and deactivated, which
facilitates \textit{in place} transformations that do not require
the creation of a separate copy of the original model.  Thus, bilevel
models can be transformed and solved, and the resulting solution
can be easily mapped back into the original model.

We describe how these transformations can be applied to reformulate
a bilevel formulation that is used identify worst-case security
risks for power grid disruptions (e.g. terrorist attacks or vandals).
The bilevel formulation is used to identify critical system components
by finding the most disruptive attacks given limited attacker
resources.  The impact of a disruption is derived from a power flow
model, which could be weighted (e.g. to balance equities in different
regions with different network toplogies).  Power flow is modeled
with a linear DC-OPF formulation, and transformations can be applied to 
reformulate this formulation as an integer program.

We describe how these results are used to support an investment
model that prioritizes mitigation investments (e.g. to mitigate
consequences or reduce likelihood of disruptions).  The critical
components identified in the bilevel model are prioritized for
investments.  Finally, we discuss whether trilevel formulations are
suitable for the investment planning problem.  We describe ``nested
defense'' strategies that can be used to maximize the utility of
migitation over a range of possible investment budgets, and discuss
the need for multi-year investment planning.


%------- References
\paperreferences{
\vref{\label{PyomoBook17} Hart, W. E., C. D. Laird, J.-P. Watson, D. L. Woodruff, G. A. Hackebeil, B. L. Nicholson, and J. D. Siirola, \emph{Pyomo: Optimization Modeling in Python}, Springer, 2017.}

}




\end{document}

